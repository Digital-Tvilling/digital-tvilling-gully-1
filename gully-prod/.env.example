# ============================================================================
# Digital Tvilling Kubernetes Environment Configuration
# ============================================================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# Required variables are marked with [REQUIRED]
# Optional variables have sensible defaults or are feature-specific
# ============================================================================

# ----------------------------------------------------------------------------
# CORE CONFIGURATION [REQUIRED]
# ----------------------------------------------------------------------------

# Environment name (used for namespace and domain)
# Examples: prod, staging, dev, demo
ENVIRONMENT_NAME=my-environment

# Kubernetes namespace for all resources
NAMESPACE=digital-tvilling-${ENVIRONMENT_NAME}

# Base domain for services (used for DNS and ingress)
# Services will be accessible at: <service>.${DOMAIN}
DOMAIN=${NAMESPACE}

# Tailscale IP of this server [REQUIRED]
# Get it with: tailscale ip -4
TAILSCALE_IP=CHANGE_ME

# ----------------------------------------------------------------------------
# DEPLOYMENT PROFILES
# ----------------------------------------------------------------------------
# Enable/disable service groups. Set to "true" or "false"

# Core DTI services (dti-core, dti-partitur, dti-ai, frontend)
ENABLE_DTI_SERVICES=true

# Calcifer AI services (calcifer-server, gradio, mcp-server)
ENABLE_CALCIFER_SERVICES=true

# Extraction pipeline (orchestrator, graph-interface, extractors)
ENABLE_EXTRACTION_PIPELINE=true

# Keel automatic deployment updates
ENABLE_KEEL=true

# DTI Authorization service (multi-tenant RBAC)
ENABLE_DTI_AUTH=false

# DTI Skala service (canvas/project management)
ENABLE_DTI_SKALA=false

# DTSDT Business Digital Twin services
ENABLE_DTSDT=false

# ----------------------------------------------------------------------------
# POSTGRES CONFIGURATION [REQUIRED]
# ----------------------------------------------------------------------------

# Main PostgreSQL (TimescaleDB + PostGIS + pgvector)
POSTGRES_PASSWORD=CHANGE_ME
POSTGRES_IP=postgres

# ----------------------------------------------------------------------------
# EXTERNAL SERVICES [REQUIRED]
# ----------------------------------------------------------------------------

# MinIO Object Storage
MINIO_HOST=CHANGE_ME
MINIO_ACCESS_KEY=CHANGE_ME
MINIO_SECRET_KEY=CHANGE_ME

# Neo4j Graph Database (main instance)
NEO4J_URL=CHANGE_ME
NEO4J_USER=neo4j
NEO4J_PASSWORD=CHANGE_ME

# MQTT Broker
MQTT_IP=CHANGE_ME
MQTT_USER=CHANGE_ME
MQTT_PASSWORD=CHANGE_ME

# ----------------------------------------------------------------------------
# DTI SERVICES CONFIGURATION
# ----------------------------------------------------------------------------

# JWT URL for authentication
DT_JWT_URL=

# API credentials for data services
API_DT_GETDATA_KEY=
API_DT_GETDATA_CLIENT=

# Baserow integration (optional)
BASEROW_IP=
BASEROW_USER=
BASEROW_PASSWORD=
BASEROW_INSTANCE=

# OpenAI for DTI services
OPENAI_KEY=CHANGE_ME

# ----------------------------------------------------------------------------
# CALCIFER AI CONFIGURATION
# ----------------------------------------------------------------------------

# OpenAI API Key for Calcifer
CALCIFER_OPENAI_API_KEY=CHANGE_ME

# Calcifer Neo4j (can be same as main or separate)
CALCIFER_NEO4J_URL=CHANGE_ME
CALCIFER_NEO4J_READER_USERNAME=neo4j
CALCIFER_NEO4J_READER_PASSWORD=CHANGE_ME
CALCIFER_NEO4J_WRITER_USERNAME=neo4j
CALCIFER_NEO4J_WRITER_PASSWORD=CHANGE_ME
CALCIFER_NEO4J_INSTANCE_CREATOR_USERNAME=neo4j
CALCIFER_NEO4J_INSTANCE_CREATOR_PASSWORD=CHANGE_ME
CALCIFER_NEO4J_DOCUMENTS_DB=documents

# Calcifer PostgreSQL (internal service)
CALCIFER_POSTGRES_HOST=calcifer-postgres
CALCIFER_POSTGRES_PORT=5432
CALCIFER_POSTGRES_READER_USER=calcifer_reader
CALCIFER_POSTGRES_READER_PASSWORD=CHANGE_ME

# Calcifer MinIO (can be same as main)
CALCIFER_MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY}
CALCIFER_MINIO_SECRET_KEY=${MINIO_SECRET_KEY}

# Calcifer Model Settings
CALCIFER_MODEL=gpt-4o
CALCIFER_TEMPERATURE=0
CALCIFER_REASONING_EFFORT=medium
CALCIFER_USE_RESPONSES_API=false
CALCIFER_TOKEN_LIMIT_BEFORE_TRIM=100000
CALCIFER_EMBEDDING_DIMENSION=3072
CALCIFER_CONVERSATIONS_DB=calciferconversations

# Calcifer Features
CALCIFER_SOURCES_BASE_URL=
CALCIFER_PROMPT_ENRICHMENT=
CALCIFER_ALLOWED_ORIGINS=*
CALCIFER_DEPLOYMENT=${ENVIRONMENT_NAME}
CALCIFER_DEBUG=false

# AWS Bedrock (optional, for Claude models)
CALCIFER_AWS_BEDROCK_API_KEY=
CALCIFER_AWS_BEARER_TOKEN_BEDROCK=

# LangSmith Tracing (optional)
LANGSMITH_TRACING=false
LANGSMITH_ENDPOINT=https://api.smith.langchain.com
LANGSMITH_API_KEY=
LANGSMITH_PROJECT=calcifer-${ENVIRONMENT_NAME}

# ----------------------------------------------------------------------------
# DTI AUTHORIZATION CONFIGURATION (if ENABLE_DTI_AUTH=true)
# ----------------------------------------------------------------------------

# JWT Secret for token signing
# Generate with: openssl rand -base64 32
DTI_AUTH_JWT_SECRET=CHANGE_ME

# API Key for admin endpoints
# Generate with: openssl rand -hex 32
DTI_AUTH_API_KEY=CHANGE_ME

# External Identity Provider (optional)
DTI_AUTH_IDP_PROVIDER=
DTI_AUTH_IDP_ISSUER=
DTI_AUTH_IDP_JWKS_URL=
DTI_AUTH_IDP_AUDIENCE=
DTI_AUTH_IDP_BASE_URL=
DTI_AUTH_IDP_CLIENT_ID=
DTI_AUTH_IDP_CLIENT_SECRET=
DTI_AUTH_IDP_SCOPES=

# ----------------------------------------------------------------------------
# DTSDT CONFIGURATION (if ENABLE_DTSDT=true)
# ----------------------------------------------------------------------------

# Neo4j Aura for DTSDT (separate from main Neo4j)
DTSDT_NEO4J_URI=CHANGE_ME
DTSDT_NEO4J_USER=neo4j
DTSDT_NEO4J_PASSWORD=CHANGE_ME
DTSDT_NEO4J_DATABASE=neo4j

# ----------------------------------------------------------------------------
# DOCKER REGISTRY
# ----------------------------------------------------------------------------

# Image tag suffix (e.g., -dev, -latest, -prod)
# Image tag suffix for all services
# Development: -latest, -dev (continuous updates)
# Production: -stable-X.Y.Z (fixed semantic version, e.g., -stable-2026.1.3)
IMAGE_TAG_SUFFIX=-latest

# ----------------------------------------------------------------------------
# EXTRACTION PIPELINE CONFIGURATION (if ENABLE_EXTRACTION_PIPELINE=true)
# ----------------------------------------------------------------------------

# Extraction Neo4j (can be same as main or separate)
EXTRACTION_NEO4J_URL=${CALCIFER_NEO4J_URL}
EXTRACTION_NEO4J_READER_USERNAME=${CALCIFER_NEO4J_READER_USERNAME}
EXTRACTION_NEO4J_READER_PASSWORD=${CALCIFER_NEO4J_READER_PASSWORD}
EXTRACTION_NEO4J_INSTANCE_CREATOR_USERNAME=${CALCIFER_NEO4J_INSTANCE_CREATOR_USERNAME}
EXTRACTION_NEO4J_INSTANCE_CREATOR_PASSWORD=${CALCIFER_NEO4J_INSTANCE_CREATOR_PASSWORD}

# Extraction PostgreSQL
EXTRACTION_POSTGRES_HOST=calcifer-postgres
EXTRACTION_POSTGRES_PORT=5432
EXTRACTION_POSTGRES_READER_USERNAME=calcifer_reader
EXTRACTION_POSTGRES_READER_PASSWORD=${CALCIFER_POSTGRES_READER_PASSWORD}
EXTRACTION_POSTGRES_DATABASE=calcifer_threads

# Extraction MinIO
EXTRACTION_MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY}
EXTRACTION_MINIO_SECRET_KEY=${MINIO_SECRET_KEY}
EXTRACTION_MINIO_ENDPOINT_URL=https://${MINIO_HOST}
EXTRACTION_USE_MINIO=true

# Extraction OpenAI
EXTRACTION_OPENAI_API_KEY=${CALCIFER_OPENAI_API_KEY}

# Extraction defaults
EXTRACTION_DEFAULT_INSTANCE_ID=default
EXTRACTION_DEFAULT_BUCKET=documents
EXTRACTION_ENTITY_MODEL=gpt-4o
EXTRACTION_ENTITY_BATCH_SIZE=10
EXTRACTION_SPACY_MODEL=en_core_web_sm

# Per-instance Neo4j credentials (optional, for multi-tenant setups)
EXTRACTION_NEO4J_EONV_USERNAME=
EXTRACTION_NEO4J_EONV_PASSWORD=
EXTRACTION_NEO4J_RGBFASTIGHET_USERNAME=
EXTRACTION_NEO4J_RGBFASTIGHET_PASSWORD=
EXTRACTION_NEO4J_JOHANTEST_USERNAME=
EXTRACTION_NEO4J_JOHANTEST_PASSWORD=
EXTRACTION_NEO4J_DELAVALCALCIFER_USERNAME=
EXTRACTION_NEO4J_DELAVALCALCIFER_PASSWORD=
EXTRACTION_NEO4J_FACILITYMGMT_USERNAME=
EXTRACTION_NEO4J_FACILITYMGMT_PASSWORD=

# ----------------------------------------------------------------------------
# FRONTEND CONFIGURATION
# ----------------------------------------------------------------------------

# OAuth configuration
OAUTH_AUTHORIZATION_ENDPOINT=https://auth.digitaltvilling.io/oauth2/auth
OAUTH_TOKEN_ENDPOINT=https://auth.digitaltvilling.io/oauth2/token
OAUTH_TOKEN_REVOCATION_ENDPOINT=https://auth.digitaltvilling.io/oauth2/sessions/logout
OAUTH_JWT_URL=https://auth.digitaltvilling.io/.well-known/jwks.json
OAUTH_CLIENT_ID=
OAUTH_CLIENT_SECRET=
SESSION_SECRET=

# Ory integration
ORY_PROJECT_SLUG=
ORY_API_KEY=

# Mapbox
MAPBOX_ACCESS_TOKEN=

# GitHub
GH_ACCESS_TOKEN=
GITHUB_API_TOKEN=

# ----------------------------------------------------------------------------
# CALCIFER ADDITIONAL CONFIGURATION
# ----------------------------------------------------------------------------

# Calcifer PostgreSQL password (for init script)
CALCIFER_POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

# GitHub token for coding MCP server
CALCIFER_GITHUB_TOKEN=${GITHUB_API_TOKEN}

# ElevenLabs (optional, for voice features)
ELEVENLABS_API_KEY=
ELEVENLABS_DEFAULT_VOICE_ID=
ELEVENLABS_DEFAULT_LANGUAGE=en
ELEVENLABS_DEFAULT_PHONE_NUMBER_ID=

# Neo4j Calcifer instance name
NEO4J_CALCIFER_INSTANCE=default

# ----------------------------------------------------------------------------
# GARAGE S3 CONFIGURATION (if using garage optional manifests)
# ----------------------------------------------------------------------------

# RPC secret for internal node communication
# Generate with: openssl rand -hex 32
GARAGE_RPC_SECRET=CHANGE_ME

# Admin API authentication token (used by WebUI)
# Generate with: openssl rand -base64 32
GARAGE_ADMIN_TOKEN=CHANGE_ME

# Metrics endpoint authentication token
# Generate with: openssl rand -base64 32
GARAGE_METRICS_TOKEN=CHANGE_ME
